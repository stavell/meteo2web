var Server={};Server.requestBuffer=[];Server.sendRequestWaitTimer=-1;Server.sendRequestWaitTime=100;Server.call=function(d,e,a,f,b){var c;if(typeof(d)!="object"||d===null){c={target:d,params:e,successFn:a,errorFn:f,context:b}}else{c=jQuery.extend({},d)}c.params=c.params||[];c.successFn=c.successFn||function(){};c.errorFn=c.errorFn||Server.defaultErrorFn;c.context=c.context||{};Server.requestBuffer.push(c);if(Server.sendRequestWaitTimer!=-1){clearTimeout(Server.sendRequestWaitTimer)}if(c.delay===-1){}else{c.delay=parseInt(c.delay);c.delay=c.delay||Server.sendRequestWaitTime;Server.sendRequestWaitTimer=setTimeout(function(){Server.sendRequests()},c.delay)}};Server.sendRequests=function(){var a=Server.requestBuffer;Server.requestBuffer=[];clearTimeout(Server.sendRequestWaitTimer);var c=[];for(var b=0;b<a.length;b++){c.push({target:a[b].target,params:a[b].params})}jQuery.ajax({type:"POST",url:"api.php",data:{requests:JSON.stringify(c)},dataType:"json",error:function(d,f,e){alert("connection error")},success:function(g,h,f){if(!g||!g.length){alert("connection error")}for(var d=0;d<a.length;d++){try{if(g[d].error){a[d].errorFn.apply(a[d].context,[g[d].error])}else{a[d].successFn.apply(a[d].context,[g[d].response])}}catch(e){if(typeof(console)!="undefined"&&typeof(console.log)=="function"){console.log(e)}}}},timeout:30000})};Server.defaultErrorFn=function(a){alert(a.message)};